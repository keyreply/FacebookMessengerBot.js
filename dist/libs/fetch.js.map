{"version":3,"sources":["../../src/libs/fetch.js"],"names":["fetch","url","opts","resolve","reject","body","json","headers","method","req","toLowerCase","query","send","credentials","withCredentials","k","v","set","end","err","res","response","error","status","_method","path","text","Object","defineProperty","value","enumerable","configurable","e","ee","test","JSON","parse","trim"],"mappings":"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","file":"fetch.js","sourcesContent":["import request from \"superagent\";\r\n\r\nexport default function fetch(url, opts = {}) {\r\n  return new Promise((resolve, reject) => {\r\n    if (typeof opts.body === \"object\" || opts.json) {\r\n      opts.headers = Object.assign(\r\n        { \"Content-Type\": \"application/json\" },\r\n        opts.headers || {}\r\n      );\r\n    }\r\n\r\n    const method = opts.method || \"get\";\r\n    let req = request[method.toLowerCase()](url);\r\n\r\n    req = req.query(opts.query);\r\n\r\n    if (opts.method === \"get\") {\r\n      req = req.query(opts.body);\r\n    } else {\r\n      req = req.send(opts.body);\r\n    }\r\n\r\n    if (opts.credentials) {\r\n      req = req.withCredentials();\r\n    }\r\n\r\n    if (opts.headers) {\r\n      for (const [k, v] of Object.entries(opts.headers)) {\r\n        req = req.set(k, v);\r\n      }\r\n    }\r\n\r\n    req.end((err, res) => {\r\n      if (err) {\r\n        try {\r\n          if (err.response && err.response.error) {\r\n            err = err.response.error;\r\n          } else if (res.error) {\r\n            err = res.error;\r\n          }\r\n\r\n          const { status, method: _method, path, text } = err;\r\n\r\n          Object.defineProperty(err, \"res\", {\r\n            value: res,\r\n            enumerable: false,\r\n            configurable: false\r\n          });\r\n          Object.defineProperty(err, \"status\", {\r\n            value: status,\r\n            enumerable: false,\r\n            configurable: false\r\n          });\r\n          Object.defineProperty(err, \"method\", {\r\n            value: _method,\r\n            enumerable: false,\r\n            configurable: false\r\n          });\r\n          Object.defineProperty(err, \"path\", {\r\n            value: path,\r\n            enumerable: false,\r\n            configurable: false\r\n          });\r\n          Object.defineProperty(err, \"text\", {\r\n            value: text,\r\n            enumerable: false,\r\n            configurable: false\r\n          });\r\n        } catch (e) {\r\n          try {\r\n            Object.defineProperty(err, \"res\", {\r\n              value: res,\r\n              enumerable: false,\r\n              configurable: false\r\n            });\r\n          } catch (ee) {\r\n            // fallback for crappy browsers\r\n            err.res = res;\r\n          }\r\n        }\r\n\r\n        reject(err);\r\n      } else {\r\n        if (\r\n          (opts.json || /\\/json/g.test(res.headers[\"Content-Type\"])) &&\r\n          res.text\r\n        ) {\r\n          try {\r\n            res.body = JSON.parse(res.text.trim());\r\n          } catch (e) {\r\n            // ignore\r\n          }\r\n        }\r\n\r\n        resolve(res);\r\n      }\r\n    });\r\n  });\r\n}\r\n"]}